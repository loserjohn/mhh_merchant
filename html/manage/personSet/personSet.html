<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>个人中心</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../../css/common.css" />
		<link rel="stylesheet" href="../../../css/iconfont.css" />
		<style>
			.personMsg {
				background: rgba(21, 21, 21, 1);
				padding-bottom: 10px;
			}
			
			.personMsg .avatar {
				width: 60px;
				height: 60px;
				border: 2px solid #fff;
				border-radius: 3px;
			}
			
			.personMsg .personMsgTitle {
				margin-top: 5px;
			}
			
			.personMsgList i {
				font-size: 24px;
			}
			
			.personMsgList .mui-media-body {
				text-align: right;
			}
			
			.personMsgList .mui-ellipsis {
				text-align: right;
			}
		</style>
	</head>

	<body>
		<div id="app">
			<header class="mui-bar mui-bar-nav " id="header">
				<button class="mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left cor_w"><span class="mui-icon mui-icon-left-nav "></span>返回</button>
				<h1 class="mui-title">个人中心</h1>
				<a class=" mui-pull-right cor_y fs16" style="line-height: 45px" @tap="_navigaterTo('../../../notice.html','notice',{type:1})">
					须知
				</a>
			</header>
			<!--简要信息-->
			<div class="personMsg  " id="content">
				<div class="flex container" style="">
					<img :src="avatar?avatar:'../../../images/default_avatar.jpg'" alt="" class="avatar" />
					<div class="f1 ">
						<h3 class="cor_w t_r personMsgTitle">{{personMsg?personMsg.ACCOUNT_PETNAME:''}}</h3>
						<p class="cor_w t_r" @tap="changeAvatar">更换头像<i class="iconfont icon-arrowright"></i></p>
					</div>
				</div>
			</div>
			<!--资料项-->
			<ul class="mui-table-view  personMsgList">
				<!--等级-->
				<li class="mui-table-view-cell flex">
					<i class="iconfont icon-vip mui-pull-left cor_y "></i>
					<div class="f1 t_r">
						等级 : {{personMsg?personMsg.SHOP.SHOP_STAR:''}}
					</div>
				</li>
				<li class="mui-table-view-cell ">
					<!--<a class="mui-navigate-right">-->
					<i class="iconfont icon-geren  mui-pull-left cor_y"></i>
					<div class="f1 t_r">
						{{personMsg?personMsg.ACCOUNT_SEX:''}}
					</div>
					<!--</a>-->

				</li>
				<!--身份证-->
				<li class="mui-table-view-cell ">
					<i class="iconfont icon-wxbzhanghu mui-pull-left cor_y"></i>
					<div class="f1 t_r">
						{{personMsg?personMsg.CARD_NUM:''}}
					</div>
				</li>
				<!--联系方式-->
				<li class="mui-table-view-cell ">
					<i class="iconfont icon-phone  mui-pull-left cor_y"></i>
					<div class="f1 t_r">
						{{personMsg?personMsg.ACCOUNT_MOBILE:''}}
					</div>
				</li>
				<!--满意度-->
				<li class="mui-table-view-cell ">
					<i class="iconfont icon-shoucang1  mui-pull-left cor_y"></i>
					<div class="f1 t_r">
						关注度 : {{personMsg?personMsg.SHOP.SHOP_CONCERN:''}}
					</div>
				</li>
				<!--艾草值-->
				<li class="mui-table-view-cell ">
					<!--<a class="mui-navigate-right">-->
					<i class="iconfont icon-rfq  mui-pull-left cor_y"></i>
					<div class="f1 t_r">
						小草值 {{personMsg?personMsg.SHOP.INTEGRAL:''}}
					</div>
					<!--</a>-->

				</li>

				<!--银行卡-->
				<!--<li class="mui-table-view-cell " @tap="_toBanks">
					<a class="mui-navigate-right">
						<i class="iconfont icon-bangdingyinhangqia  mui-pull-left cor_y"></i>
						<div class="f1 t_r" style="margin-right: 20px;">
							银行卡管理
						</div>
					</a>
				</li>-->
				<!--支付宝账户-->
				<!--<li class="mui-table-view-cell ">
					<a class="mui-navigate-right">
						<i class="iconfont icon-zhifubao  mui-pull-left cor_y"></i>
						<div class="f1 t_r" style="margin-right: 20px;">
							15059201547
						</div>
					</a>
				</li>
				<!--微信账户-->
				<!--<li class="mui-table-view-cell ">
					<a class="mui-navigate-right">
						<i class="iconfont icon-weixinzhifu  mui-pull-left cor_y"></i>
						<div class="f1 t_r" style="margin-right: 20px;">
							ad2551_dfs
						</div>
					</a>
				</li>-->

			</ul>
			<!--退出账户-->

			<div class="container">
				<div class="cm_btn" @click="_loginOut">
					退出账户
				</div>
			</div>

		</div>
		<script src="../../../js/mui.min.js"></script>
		<script src="../../../js/util.js"></script>
		<script src="../../js/imgClip.js"></script>
		<script src="../../../js/app.js"></script>
		<script src="../../../js/vue.js"></script>
		<script src="../../../js/imgClip.js"></script>
		<script src="../../../js/aes.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			mui.init({
				swipeBack: true
			});
			var APP
			mui.plusReady(function() {
				app.WXinit(CryptoJS)
				APP = new Vue({
					el: '#app',
					data: {
						personMsg: '',
						avatar: ''
					},
					created: function() {
						app.initHeader();
					},
					mounted: function() {

						this._getData(() => {
							plus.nativeUI.closeWaiting()
							mui.currentWebview.show('pop-in', 300, function() {}, {});
						})
					},
					methods: {
						/*跳转页面*/
						_navigateTo(dstUrl, dstId, extras) {
							mui.openWindow({
								url: dstUrl,
								id: dstId,
								styles: {
									top: '0px', //新页面顶部位置
									bottom: '0px', //新页面底部位置
									scrollIndicator: "none",
									plusrequire: 'ahead'
								},
								createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
								show: {
									autoShow: false, //页面loaded事件发生后自动显示，默认为true
									duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
								},
								extras: extras,
								waiting: {
									autoShow: true, //自动显示等待框，默认为true
									title: '正在加载...', //等待对话框上显示的提示内容
								}
							})
						},
						/*获取信息*/
						_getData(callback) {
							var _this = this
							app.ajax(app.baseUrl + '/api/BusiAccount/GetAccountInfo', {
								//							data: Info,
								// dataType:'json',//服务器返回json格式数据
								type: 'get', //HTTP请求类型
								success: function(result) {
									/*登陆成功*/
									if(result.Success) {
										_this.personMsg = result.Data
										_this.avatar = result.Data.SHOP.SHOP_LOGO
										if(callback) callback();
									} else {
										/*验证失败*/
										if(callback) callback(false, result.Msg)

									}
								}
							});
						},
						/*登出*/
						_loginOut() {
							plus.nativeUI.confirm("退出当前用户？", function(e) {
								if(e.index == 0) {
									//										alert(1)
									plus.storage.clear();
									plus.webview.getWebviewById('home').close();
									if(plus.webview.getWebviewById('chat')){
										plus.webview.getWebviewById('chat').close();
									}
									
									
									
									mui.openWindow({
										url: '../../../index.html',
										id: 'index',
										styles: {
											top: '0px', //新页面顶部位置
											bottom: '0px', //新页面底部位置
											scrollIndicator: "none",
											plusrequire: 'ahead'
										},
										show: {
											autoShow: true, //页面loaded事件发生后自动显示，默认为true
											duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
										},
										createNew: true,
										extras: {
											//自定义扩展参数，可以用来处理页面间传值  
										},
										waiting: {
											autoShow: false, //自动显示等待框，默认为true
											title: '正在加载...', //等待对话框上显示的提示内容
										}
									})
								}

							});
						},
						/*跳转银行卡管理*/
						_toBanks() {
							mui.openWindow({
								url: '../banks/banks.html',
								id: 'banks',
								styles: {
									top: '0px', //新页面顶部位置
									bottom: '0px', //新页面底部位置
									scrollIndicator: "none",
									plusrequire: 'ahead'
								},
								show: {
									autoShow: false, //页面loaded事件发生后自动显示，默认为true
									duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
								},
								extras: {
									//自定义扩展参数，可以用来处理页面间传值  
								},
								waiting: {
									autoShow: true, //自动显示等待框，默认为true
									title: '正在加载...', //等待对话框上显示的提示内容
								}
							})
						},
						/*换头像*/
						changeAvatar() {
							var _this = this
							Clip.getIMG('选择头像', (src) => {
								//								console.log(src)
								mui.openWindow({
									url: '../imgClick.html',
									id: 'imgClick',
									styles: {
										top: '0px', //新页面顶部位置
										bottom: '0px', //新页面底部位置
										scrollIndicator: "none",
										plusrequire: 'ahead'
									},
									createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
									show: {
										autoShow: false, //页面loaded事件发生后自动显示，默认为true
										duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
									},
									extras: {
										img: src,
										pid: 'personSet',
										size: 3
									},
									waiting: {
										autoShow: true, //自动显示等待框，默认为true
										title: '正在加载...', //等待对话框上显示的提示内容
									}
								})
							})
						},
						_chooseAvatar(res) {
							var _this = this
							if(!res) return;
							
							this._upload({
								SHOP_LOGO: res.src
							}, () => {
								_this.avatar = res.src
							})
						},
						//							修改资料
						_upload(option, callback) {
							if(!option) return;
							//							console.log(JSON.stringify(option))
							plus.nativeUI.showWaiting()
							app.ajax(app.baseUrl + '/api/BusiShop/UpdateShop', {
								data: option,
								type: 'post', //HTTP请求类型
								success: function(result) {
									if(result.Success) {
										mui.later(() => {
											plus.nativeUI.closeWaiting()
											if(callback) callback();
											plus.webview.getWebviewById('home').evalJS('refresh()')
										}, 1000)

									} else {
										plus.nativeUI.closeWaiting()
										plus.nativeUI.toast(result.Msg)

									}
								},
								error: function(xhr, type, errorThrown) {
									console.log(type);
								}
							});
						},
					}

				})

			});

			function choosePic(res) {
				res = JSON.parse(res)
				APP._chooseAvatar(res)
			}
		</script>
	</body>

</html>